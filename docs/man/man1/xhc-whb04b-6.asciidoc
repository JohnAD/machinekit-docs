---
---
:skip-front-matter:

= XHC-WHB04B-6
:manmanual: HAL Components
:mansource: ../man/man1/xhc-whb04b-6.asciidoc
:man version : 0.1

== NAME
xhc-whb04b-6 - User-space jog dial HAL component for the wireless XHC-WHB04B-6 device.

== SYNOPSIS
xhc-whb04b-6 [-h] | [-H] [OPTIONS]

== DESCRIPTION
The xhc-whb04b-6 component supports a 6-axis wireless USB pendant that provides a number of pushbuttons, a manual pulse generator (mpg or jog wheel), and a selector switch for the wheel.

In addition to buttons, the pendant provides an LCD display indicating the activated axis,
current axis position (machine or relative), step size, step mode (MPG, STP, CONT),
feed rate, spindle speed (RPM), machine state (reset), battery level and wireless signal strength.

The pendant display, its rotary selector switch, and the component pin names use designators x,y,z,a,b,c.
While this arrangement presumes a machine configured as XYZABC, the pins can be assigned independently as required in a HAL configuration.

== OPTIONS
-h +
Prints the synopsis and the most commonly used commands.

-H +
run xhc-whb04b-6 in HAL-mode instead of interactive mode.
When in HAL mode commands from device will be exposed to HAL's shred memory.
Interactive mode is useful for testing device connectivity and debugging.

-t +
Wait with timeout for USB device then proceed, exit otherwise.
Without -t the timeout is implicitly infinite.

-u, -U +
Show received data from device. With -U received and transmitted data will be printed.
Output is prefixed with "usb".

-p +
Show HAL pins and HAL related messages. Output is prefixed with "hal".

-e +
Show captured events such as button pressed/released, jog dial, axis rotary button, and feed rotary button event.
Output is prefixed with "event".

-a +
Enable all logging facilities without explicitly specifying each.

-c +
Enable checksum output which is necessary for debugging the checksum generator function.
Do not rely on this feature since it will be removed once the generator is implemented.

-n +
Force being silent and not printing any output except of errors.
This will also inhibit messages prefixed with "init".

== UDEV
The xhc-whb04b-6 executable needs permission for reading the pendant's USB device.
Debian package installs (debs) handle this automatically but Run-In-Place (RIP) builds may need a udev rules file.
This file should be created (using sudo and a text editor) as:

`/etc/udev/rules.d/99-xhc-whb04b-6.rules` with the single line: +
`ATTR{idProduct}=="eb93", ATTR{idVendor}=="10ce", MODE="0666", OWNER="root", GROUP="plugdev"`

== Standalone Usage
The xhc-whb04b-6 program can be run from the command line without LinuxCNC to test a pendant.
This standalone mode is used to identify the button codes produced for each button press and debug transmitted USB data. 

=== EXAMPLES
xhc-whb04b-6 -ue +
Prints incoming USB data transfer and generated key pressed/released events.

xhc-whb04b-6 -p +
Prints hal pin names and events distributed to HAL memory.

xhc-whb04b-6 -Ha +
Start in HAL mode and avoid output, except of errors.

== Hal Usage
Use the -H option to specify HAL mode and other options as required: +
loadusr -W xhc-whb04b-6 -H

=== Input/Output Pins
For each button an output pin is provided even if not any functionality is realized via one direct signal.
To stop a running program the button may be directly connected to halui.program.stop,
whereas to start/pause/resume a program, the corresponding button toggles besides whb.button.start-pause
also the halui.program.{run,pause,resume} signals accordingly.

The following table lists all in-/output pins and state which signals they are meant to be connected to.

[width="100%", options="header"]
|=======
| Type  | Direction | Signal Name                         | Notes                                                      |
| bit   | in        | whb.stepgen.N.maxvel                | connect to stepgen.N.maxvel                                |
| bit   | in        | whb.stepgen.N.maxvel                | connect to stepgen.N.maxvel                                |
| bit   | in        | whb.stepgen.N.maxvel                | connect to stepgen.N.maxvel                                |
| bit   | in        | whb.stepgen.N.maxvel                | connect to stepgen.N.maxvel                                |
| bit   | in        | whb.stepgen.N.maxvel                | connect to stepgen.N.maxvel                                |
| bit   | in        | whb.stepgen.N.maxvel                | connect to stepgen.N.maxvel                                |
| bit   | in        | whb.stepgen.N.position-scale        | connect to stepgen.N.position-scale                        |
| bit   | in        | whb.stepgen.N.position-scale        | connect to stepgen.N.position-scale                        |
| bit   | in        | whb.stepgen.N.position-scale        | connect to stepgen.N.position-scale                        |
| bit   | in        | whb.stepgen.N.position-scale        | connect to stepgen.N.position-scale                        |
| bit   | in        | whb.stepgen.N.position-scale        | connect to stepgen.N.position-scale                        |
| bit   | in        | whb.stepgen.N.position-scale        | connect to stepgen.N.position-scale                        |
| bit   | in        | whb.halui.feed-override.value       | connect to halui.feed-override.value                       |
| bit   | in        | whb.halui.spindle.is-on             | connect to halui.spindle.is-on                             |
| bit   | in        | whb.halui.spindle-override.value    | connect to halui.spindle-override.value                    |
| bit   | in        | whb.halui.program.is-running        | connect to halui.program.is-running                        |
| bit   | in        | whb.halui.program.is-paused         | connect to halui.program.is-paused                         |
| bit   | in        | whb.halui.program.is-idle           | connect to halui.program.is-idle                           |
| bit   | in        | whb.halui.mode.is-auto              | connect to halui.mode.is-auto                              |
| bit   | in        | whb.halui.mode.is-joint             | connect to halui.mode.is-joint                             |
| bit   | in        | whb.halui.mode.is-manual            | connect to halui.mode.is-manual                            |
| bit   | in        | whb.halui.mode.is-mdi               | connect to halui.mode.is-mdi                               |
| bit   | in        | whb.halui.mode.is-                  | connect to halui.mode.is-                                  |
| bit   | in        | whb.halui.mode.is-                  | connect to halui.mode.is-                                  |
| bit   | in        | whb.halui.mode.is-                  | connect to halui.mode.is-                                  |
| bit   | in        | whb.halui.estop.is-activated        | connect to halui.estop.is-activated                        |
| bit   | in        | whb.halui.machine.is-on             | connect to halui.machine.is-on                             |
| bit   | out       | whb.button.reset                    | use whb.halui.estop.{activate, reset}                      |
| bit   | out       | whb.button.macro-11                 | connect to halui.mdi-command-NN, Fn + RESET                |
| bit   | out       | whb.button.stop                     | use halui.program.stop                                     |
| bit   | out       | whb.button.macro-12                 | connect to halui.mdi-command-NN,  Fn + Stop                |
| bit   | out       | whb.button.start-pause              | use whb.halui.program{run, pause, resume}                  |
| bit   | out       | whb.button.macro-13                 | connect to halui.mdi-command-NN,  Fn + Start/Pause         |
| bit   | out       | whb.button.feed-plus                |                                                            |
| bit   | out       | whb.button.macro-1                  | connect to halui.mdi-command-NN                            |
| bit   | out       | whb.button.feed-minus               |                                                            |
| bit   | out       | whb.button.macro-2                  | connect to halui.mdi-command-NN                            |
| bit   | out       | whb.button.spindle-plus             | use whb.halui.spindle-override.increase                    |
| bit   | out       | whb.button.macro-3                  |                                                            |
| bit   | out       | whb.button.spindle-minus            | use whb.halui.spindle-override.decrease                    |
| bit   | out       | whb.button.macro-4                  |                                                            |
| bit   | out       | whb.button.m-home                   | go to m-home (not homing), connect to halui.mdi-command-NN |
| bit   | out       | whb.button.macro-5                  | connect to halui.mdi-command-NN                            |
| bit   | out       | whb.button.safe-z                   | connect to halui.mdi-command-NN                            |
| bit   | out       | whb.button.macro-6                  | connect to halui.mdi-command-NN                            |
| bit   | out       | whb.button.w-home                   | connect to halui.mdi-command-NN                            |
| bit   | out       | whb.button.macro-7                  | connect to halui.mdi-command-NN                            |
| bit   | out       | whb.button.s-on-off                 | use whb.halui.spindle.{start, stop}                        |
| bit   | out       | whb.button.macro-8                  | connect to halui.mdi-command-NN                            |
| bit   | out       | whb.button.fn                       |                                                            |
| bit   | out       | whb.button.probe-z                  | connect to halui.mdi-command-NN                            |
| bit   | out       | whb.button.macro-9                  | connect to halui.mdi-command-NN                            |
| bit   | out       | whb.button.macro-10                 | connect to halui.home-all, same as whb.halui.home-all      |
| bit   | out       | whb.button.macro-14                 | connect to halui.mdi-command-NN, Fn + macro-10             |
| bit   | out       | whb.button.mode-continuous          |                                                            |
| bit   | out       | whb.button.macro-15                 | connect to halui.mdi-command-NN, Fn + MPG                  |
| bit   | out       | whb.button.step                     |                                                            |
| bit   | out       | whb.button.macro-16                 | connect to halui.mdi-command-NN, Fn + Step\|Continuous     |
| bit   | out       | whb.axis.0.jog-counts               | connect to axis.0.jog-counts                               |
| bit   | out       | whb.axis.1.jog-counts               | connect to axis.1.jog-counts                               |
| bit   | out       | whb.axis.2.jog-counts               | connect to axis.2.jog-counts                               |
| bit   | out       | whb.axis.3.jog-counts               | connect to axis.3.jog-counts                               |
| bit   | out       | whb.axis.4.jog-counts               | connect to axis.4.jog-counts                               |
| bit   | out       | whb.axis.5.jog-counts               | connect to axis.5.jog-counts                               |
| bit   | out       | whb.axis.0.jog-enable               | connect to axis.0.jog-enable                               |
| bit   | out       | whb.axis.1.jog-enable               | connect to axis.1.jog-enable                               |
| bit   | out       | whb.axis.2.jog-enable               | connect to axis.2.jog-enable                               |
| bit   | out       | whb.axis.3.jog-enable               | connect to axis.3.jog-enable                               |
| bit   | out       | whb.axis.4.jog-enable               | connect to axis.4.jog-enable                               |
| bit   | out       | whb.axis.5.jog-enable               | connect to axis.5.jog-enable                               |
| bit   | out       | whb.axis.0.jog-scale                | connect to axis.0.jog-scale                                |
| bit   | out       | whb.axis.1.jog-scale                | connect to axis.1.jog-scale                                |
| bit   | out       | whb.axis.2.jog-scale                | connect to axis.2.jog-scale                                |
| bit   | out       | whb.axis.3.jog-scale                | connect to axis.3.jog-scale                                |
| bit   | out       | whb.axis.4.jog-scale                | connect to axis.4.jog-scale                                |
| bit   | out       | whb.axis.5.jog-scale                | connect to axis.5.jog-scale                                |
| bit   | out       | whb.axis.0.jog-jog-vel-mode         | connect to axis.0.jog-jog-vel-mode                         |
| bit   | out       | whb.axis.1.jog-jog-vel-mode         | connect to axis.1.jog-jog-vel-mode                         |
| bit   | out       | whb.axis.2.jog-jog-vel-mode         | connect to axis.2.jog-jog-vel-mode                         |
| bit   | out       | whb.axis.3.jog-jog-vel-mode         | connect to axis.3.jog-jog-vel-mode                         |
| bit   | out       | whb.axis.4.jog-jog-vel-mode         | connect to axis.4.jog-jog-vel-mode                         |
| bit   | out       | whb.axis.5.jog-jog-vel-mode         | connect to axis.5.jog-jog-vel-mode                         |
| bit   | out       | whb.axis.0.jog-enable               | connect to axis.0.jog-enable                               |
| bit   | out       | whb.axis.1.jog-enable               | connect to axis.1.jog-enable                               |
| bit   | out       | whb.axis.2.jog-enable               | connect to axis.2.jog-enable                               |
| bit   | out       | whb.axis.3.jog-enable               | connect to axis.3.jog-enable                               |
| bit   | out       | whb.axis.4.jog-enable               | connect to axis.4.jog-enable                               |
| bit   | out       | whb.axis.5.jog-enable               | connect to axis.5.jog-enable                               |
| bit   | out       | whb.axis.0.jog-enable               | connect to axis.0.jog-enable                               |
| bit   | out       | whb.axis.1.jog-enable               | connect to axis.1.jog-enable                               |
| bit   | out       | whb.axis.2.jog-enable               | connect to axis.2.jog-enable                               |
| bit   | out       | whb.axis.3.jog-enable               | connect to axis.3.jog-enable                               |
| bit   | out       | whb.axis.4.jog-enable               | connect to axis.4.jog-enable                               |
| bit   | out       | whb.axis.5.jog-enable               | connect to axis.5.jog-enable                               |
| bit   | out       | whb.halui.spindle.start             | connect to halui.spindle.start                             |
| bit   | out       | whb.halui.spindle.stop              | connect to halui.spindle.stop                              |
| bit   | out       | whb.halui.spindle.decrease          | connect to halui.spindle.decrease                          |
| bit   | out       | whb.halui.spindle.increase          | connect to halui.spindle.increase                          |
| bit   | out       | whb.halui.spindle-override.increase | connect to halui.spindle-override.increase                 |
| bit   | out       | whb.halui.spindle-override.decrease | connect to halui.spindle-override.decrease                 |
| bit   | out       | whb.halui.feed-override.decrease    | connect to halui.feed-override.decrease                    |
| bit   | out       | whb.halui.feed-override.increae     | connect to halui.feed-override.increae                     |
| bit   | out       | whb.halui.home-all                  | connect to halui.home-all, driven by macro-10              |
| bit   | out       | whb.halui.joint.0.select            | connect to halui.joint.0.select                            |
| bit   | out       | whb.halui.joint.1.select            | connect to halui.joint.1.select                            |
| bit   | out       | whb.halui.joint.2.select            | connect to halui.joint.2.select                            |
| bit   | out       | whb.halui.joint.3.select            | connect to halui.joint.3.select                            |
| bit   | out       | whb.halui.joint.4.select            | connect to halui.joint.4.select                            |
| bit   | out       | whb.halui.joint.5.select            | connect to halui.joint.5.select                            |
| bit   | out       | whb.halui.program.run               | connect to halui.program.run                               |
| bit   | out       | whb.halui.program.pause             | connect to halui.program.pause                             |
| bit   | out       | whb.halui.program.resume            | connect to halui.program.resume                            |
| bit   | out       | whb.halui.program.stop              | connect to program.stop                                    |
| bit   | out       | whb.halui.mode.auto                 | connect to halui.mode.auto                                 |
| bit   | out       | whb.halui.mode.joint                | connect to halui.mode.joint                                |
| bit   | out       | whb.halui.mode.manual               | connect to halui.mode.manual                               |
| bit   | out       | whb.halui.mode.mdi                  | connect to halui.mode.mdi                                  |
| bit   | out       | whb.halui.estop.activate            | connect to halui.estop.activate                            |
| bit   | out       | whb.halui.estop.reset               | connect to halui.estop.reset                               |
| bit   | out       | whb.halui.machine.on                | connect to halui.machine.on                                |
| bit   | out       | whb.halui.machine.off               | connect to halui.machine.off                               |
| bit   | out       | whb.pendant.is-sleeping             |                                                            |
| bit   | out       | whb.pendant.is-connected            |                                                            |
|=======


== SEE ALSO 
xhc-hb04.1(1), https://github.com/machinekit/machinekit/tree/master/src/hal/user_comps/xhc-whb04b-6/[xhc-whb04b-6 developer documentation on Github]

== NOTES
The CRC code function is not disclosed by the manufacturer.
Ths the CRC value transmitted with each package is not checked yet.
Feel free to help us enhance the component.
    
== AUTHORS
This component was started by Raoul Rubien (https://github.com/rubienr) based on predecessor device's component xhc-hb04.cc.
https://github.com/machinekit/machinekit/graphs/contributors gives you a more complete list of contributors.
    
== REPORTING BUGS
Report bugs via the machinekit forum at https://groups.google.com/forum/#!forum/machinekit

== HISTORY
The component was developed accidentally as leisure project.
The development started with the xhc-whb04 (4-axis wireless pendant) implementation as reference.
73 & many thanks to the developers who delivered provided an excellent preparatory work!

== COPYRIGHT
Copyright (c) 2018 Raoul Rubien.
This is free software; see the source for copying conditions. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
